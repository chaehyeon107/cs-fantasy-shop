generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//
// ENUM
//
enum ItemRarity {
  COMMON
  RARE
  EPIC
  LEGENDARY
  BUGGED
  SEGFAULT
}

//
// User
// ë¡œê·¸ì¸ + RBAC + ì†Œì…œ ë¡œê·¸ì¸ì„ ëª¨ë‘ ì´ìª½ìœ¼ë¡œ ì˜®ê¸¸ ì˜ˆì •
//
model User {
  id         Int      @id @default(autoincrement()) @map("id")
  email      String   @unique                      @map("email")
  password   String                                @map("password")
  nickname   String                                @map("nickname")
  role       String   @default("ROLE_USER")         @map("role")
  provider   String   @default("local")             @map("provider")
  providerId String?                                @map("provider_id")

  createdAt  DateTime @default(now())               @map("created_at")
  updatedAt  DateTime @updatedAt                    @map("updated_at")

  @@index([provider, providerId])
  @@map("users")  // í…Œì´ë¸” ì´ë¦„ë„ snake_case ì¶”ì²œ (optional)
}

//
// Category
//
model Category {
  id          Int       @id @default(autoincrement()) @map("id")
  name        String                                   @map("name")
  description String?                                  @map("description")
  parentId    Int?                                     @map("parent_id")

  parent      Category? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")

  items       Item[]

  createdAt   DateTime  @default(now())               @map("created_at")
  updatedAt   DateTime  @updatedAt                    @map("updated_at")

  @@map("categories")
  @@index([name])
}


//
// Item
//
model Item {
  id            Int         @id @default(autoincrement()) @map("id")
  name          String                                      @map("name")
  price         Int                                         @map("price")
  description   String?                                     @map("description")

  rarity        ItemRarity @default(COMMON)                @map("rarity")
  statInt       Int        @default(0)                     @map("stat_int")
  statStr       Int        @default(0)                     @map("stat_str")
  statDex       Int        @default(0)                     @map("stat_dex")
  statLck       Int        @default(0)                     @map("stat_lck")

  csTag         String?                                    @map("cs_tag")
  stockQuantity Int        @default(0)                     @map("stock_quantity")
  isActive      Boolean     @default(true)                 @map("is_active")

  // ğŸ”— Category FK (nullable: ì¹´í…Œê³ ë¦¬ ì—†ëŠ” ì•„ì´í…œë„ í—ˆìš©)
  categoryId    Int?                                       @map("category_id")
  category      Category?  @relation(fields: [categoryId], references: [id])

  createdAt     DateTime    @default(now())                @map("created_at")
  updatedAt     DateTime    @updatedAt                     @map("updated_at")

  // ğŸ” ê²€ìƒ‰/ì •ë ¬ìš© ì¸ë±ìŠ¤
  @@index([categoryId])
  @@index([price])
  @@index([rarity])
  @@index([csTag])
  @@index([createdAt])
  @@map("items")
}


