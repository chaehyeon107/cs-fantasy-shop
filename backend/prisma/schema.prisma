generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//
// ENUM
//
enum ItemRarity {
  COMMON
  RARE
  EPIC
  LEGENDARY
  BUGGED
  SEGFAULT
}

//
// User
//
model User {
  id         Int     @id @default(autoincrement()) @map("id")
  email      String  @unique @map("email")
  password   String  @map("password")
  nickname   String  @map("nickname")
  role       String  @default("ROLE_USER") @map("role")
  provider   String  @default("local") @map("provider")
  providerId String? @map("provider_id")

  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")

  cartItems CartItem[]

  @@index([provider, providerId])
  @@map("users")
}

//
// Category
//
model Category {
  id          Int     @id @default(autoincrement()) @map("id")
  name        String  @map("name")
  description String? @map("description")
  parentId    Int?    @map("parent_id")

  parent   Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children Category[] @relation("CategoryHierarchy")

  items Item[]   // ‚úÖ CartItem ÏßÅÏ†ë Ïó∞Í≤∞ Ï†úÍ±∞

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([name])
  @@map("categories")
}

//
// Item
//
model Item {
  id          Int     @id @default(autoincrement()) @map("id")
  name        String  @map("name")
  price       Int     @map("price")
  description String? @map("description")

  rarity  ItemRarity @default(COMMON) @map("rarity")
  statInt Int        @default(0) @map("stat_int")
  statStr Int        @default(0) @map("stat_str")
  statDex Int        @default(0) @map("stat_dex")
  statLck Int        @default(0) @map("stat_lck")

  csTag         String? @map("cs_tag")
  stockQuantity Int     @default(0) @map("stock_quantity")
  isActive      Boolean @default(true) @map("is_active")

  // üîó Category FK
  categoryId Int?       @map("category_id")
  category   Category? @relation(fields: [categoryId], references: [id])

  cartItems CartItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([categoryId])
  @@index([price])
  @@index([rarity])
  @@index([csTag])
  @@index([createdAt])
  @@map("items")
}

//
// CartItem  ‚úÖ ÏµúÏ¢Ö Ï†ïÎãµ Íµ¨Ï°∞
//
model CartItem {
  id        Int      @id @default(autoincrement())
  userId    Int
  itemId    Int
  quantity  Int
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
  item Item @relation(fields: [itemId], references: [id])

  @@unique([userId, itemId])   // ‚úÖ Ïû•Î∞îÍµ¨Îãà Ï§ëÎ≥µ Î∞©ÏßÄ ÌïµÏã¨
  @@map("cart_items")
}
